---
title: "Report - Swiss hotel trends"
author: "Kenny Trinh; Sabin Pun"
date: "2024-08-27"
output: html_document
---

## Setup

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(dplyr)
require(tidyr)
```


## Import libraries

```{r ImportLibraries}
library(readr)
library(stringr)
library(sf)
library(leaflet)
library(lubridate)
# library(i18n)
```


```{r ImportData}
df <- read.csv("data/swiss_hotel_stays.csv", sep = ";", na.strings = "...")
# View(df)
# head(swiss_hotel_stays,n = 30)
```

```{r DataPreview}
dim(df)
head(df)
str(df)
```


```{r ImportData2}
swiss_hotel_stays_open_establishments <- read.csv("data/swiss_hotels_stays_open_establishments.csv", sep = ";")
View(swiss_hotel_stays_open_establishments)
```


# Data Preparation

```{r Data preparation}
# Skip replacing
# replace all special characters ü and â
# swiss_hotel_stays <- str_replace_all(string = swiss_hotel_stays, pattern = "\xfc", replacement = "ue")
```

```{r}
summary(df)
```


```{r CheckNAValues}
sum(is.na(df))
sapply(df, function(x) sum(is.na(x)))
```

```{r}
# Show the type of all the columns
sapply(df, class)

# Show only columns with logical type
sapply(df, is.logical)

# Create a data frame with logical columns
df_logical <- df %>%
  select_if(is.logical)

head(df_logical) # all logical columns are columns that only have NA values

# Drop logical columns from the data frame df
df <- df %>%
  select(-where(is.logical))
```


```{r DropNAValues}
# df <- df %>%
#   drop_na()
# 
# sum(is.na(df))
```

```{r}
View(df)
```


## Data Transformation
```{r}
# Create a new data frame with columns that contain the word "Arrivals" and the first 3 columns
df_arrivals <- df %>%
  select(1:3, contains("Arrivals"))
head(df_arrivals)
```

```{r}
# Show all the columns that contain the word ".Arrivals" in the data frame df_arrivals in long format
df_arrivals.long.format <- df_arrivals %>%
  pivot_longer(cols = contains("Arrivals"), names_to = "CountrOfResidence", values_to = "Arrivals")
head(df_arrivals.long.format)
```

```{r}
# Remove .Arrivals from the CountryOfResidence values
df_arrivals.long.format$CountrOfResidence <- str_remove_all(string = df_arrivals.long.format$CountrOfResidence, pattern = ".Arrivals")
head(df_arrivals.long.format)
```



```{r}
# Create a new data frame with columns that contain the word "Stays" and the first 3 columns
df_stays <- df %>%
  select(1:3, contains("Stays"))
head(df_stays)
```

```{r}
# Show all the columns that contain the word ".Stays" in the data frame df_stays in long format
df_stays.long.format <- df_stays %>%
  pivot_longer(cols = contains("Stays"), names_to = "CountrOfResidence", values_to = "Stays")
head(df_stays.long.format)
```

```{r}
# Remove .Overnight.stays from the CountryOfResidence values
df_stays.long.format$CountrOfResidence <- str_remove_all(string = df_stays.long.format$CountrOfResidence, pattern = ".Overnight.stays")
head(df_stays.long.format)
```

### Join Arrivals and Stays dataframes
```{r}
# Join the dataframes df_arrivals.long.format and df_stays.long.format
df.long.format <- df_arrivals.long.format %>%
  inner_join(df_stays.long.format, by = c("Year", "Month", "Canton", "CountrOfResidence"))
head(df.long.format)
```

### Creating the dates from Year and Month
```{r}
# Create a new column Date from Year and Month
df.long.format$Date <- as.Date(paste(df.long.format$Year, df.long.format$Month, "01", sep = "-"))
```


